#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <errno.h>

int main(int argc, char* argv[]) {
	// Check args
	if (argc != 2) {
		fprintf(stderr, "Usage: ./open <file to open>\n");
		exit(2);
	}

	// Try to open a file
	int fd1 = open(argv[1], O_CREAT|O_RDWR|O_TRUNC, 0666);
	int fd2 = dup(fd1);

	// Write to the file
	ssize_t status = write(fd1, "Blah blah This is test text\n", 18);
	if (status < 0) {
		perror("Error");
		exit(3);
	}

	// Try to write to file again
	status = write(fd2, "\nhohoho writing to file again!\n",15); 
	if (status < 0) {
		perror("Error");
		exit(3);
	}

	// Close the file
	int ret = close(fd1);
	if (ret != 0) {
		perror("error");
		exit(3);
	}

	ret = close(fd2);
	if (ret != 0) {
		perror("error");
		exit(3);
	}

	return 0;


}
